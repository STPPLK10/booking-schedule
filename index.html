<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ß‡πà‡∏≤‡∏á</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    
    h1 {
      text-align: center;
      color: #667eea;
      margin-bottom: 10px;
      font-size: 2em;
    }
    
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 0.95em;
    }
    
    .schedule-grid {
      display: grid;
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .dual-person-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 15px;
    }
    
    @media (max-width: 968px) {
      .dual-person-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .day-card {
      background: #f8f9ff;
      border-radius: 15px;
      padding: 20px;
      border: 2px solid #e0e7ff;
      transition: all 0.3s ease;
    }
    
    .day-card.couple-work {
      border: 3px solid #f59e0b;
      background: #fffbeb;
    }
    
    .day-card:hover {
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
      transform: translateY(-2px);
    }
    
    .day-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #667eea;
    }
    
    .day-header.couple {
      border-bottom: 2px solid #f59e0b;
    }
    
    .day-name {
      font-size: 1.3em;
      font-weight: bold;
      color: #667eea;
    }
    
    .day-date {
      font-size: 0.9em;
      color: #888;
    }
    
    .couple-badge {
      background: #f59e0b;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: bold;
    }
    
    .person-section {
      background: white;
      border-radius: 12px;
      padding: 15px;
      border: 2px solid #e0e7ff;
    }
    
    .person-section.jin {
      border-color: #3b82f6;
    }
    
    .person-section.ten {
      border-color: #8b5cf6;
    }
    
    .person-header {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: bold;
      margin-bottom: 15px;
      font-size: 1em;
      width: 100%;
      text-align: center;
    }
    
    .person-header.jin {
      background: #3b82f6;
      color: white;
    }
    
    .person-header.ten {
      background: #8b5cf6;
      color: white;
    }
    
    .time-slots {
      display: grid;
      gap: 10px;
    }
    
    .time-slot {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      border-radius: 10px;
      background: white;
      border: 2px solid #e0e7ff;
      transition: all 0.2s ease;
    }
    
    .time-slot.editable {
      cursor: pointer;
    }
    
    .time-slot.editable:hover {
      border-color: #667eea;
      background: #f8f9ff;
      transform: translateX(2px);
    }
    
    .time-label {
      font-weight: 600;
      color: #333;
    }
    
    .status {
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: 600;
    }
    
    .status.available {
      background: #10b981;
      color: white;
    }
    
    .status.full {
      background: #ef4444;
      color: white;
    }
    
    .copy-btn {
      padding: 6px 12px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 600;
    }
    
    .copy-all-btn {
      padding: 12px 30px;
      background: #10b981;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1.1em;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }
    
    .copy-all-btn:hover {
      background: #059669;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
    }
    
    .copy-all-btn.copied {
      background: #3b82f6;
    }
    
    .copy-btn:hover {
      background: #5568d3;
      transform: scale(1.05);
    }
    
    .copy-btn.copied {
      background: #10b981;
    }
    
    .legend {
      display: flex;
      justify-content: center;
      gap: 30px;
      padding: 20px;
      background: #f8f9ff;
      border-radius: 10px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .legend-color {
      width: 30px;
      height: 30px;
      border-radius: 50%;
    }
    
    .note {
      text-align: center;
      color: #666;
      font-size: 0.9em;
      margin-top: 20px;
      padding: 15px;
      background: #e0e7ff;
      border-radius: 10px;
      border: 1px solid #667eea;
    }
    
    .admin-section {
      margin-top: 30px;
      padding: 20px;
      background: #fff3cd;
      border-radius: 10px;
      border: 2px solid #ffc107;
    }
    
    .admin-section h3 {
      color: #856404;
      margin-bottom: 15px;
      text-align: center;
    }
    
    .admin-controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .admin-btn {
      padding: 10px 20px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 0.95em;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 600;
    }
    
    .admin-btn:hover {
      background: #5568d3;
      transform: translateY(-1px);
    }
    
    .admin-btn.toggle {
      background: #8b5cf6;
    }
    
    .admin-btn.toggle:hover {
      background: #7c3aed;
    }
    
    .unlock-btn {
      padding: 8px 20px;
      background: #e5e7eb;
      color: #6b7280;
      border: 2px solid #d1d5db;
      border-radius: 20px;
      font-size: 0.85em;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 600;
    }
    
    .unlock-btn:hover {
      background: #d1d5db;
      border-color: #9ca3af;
    }
    
    .unlock-btn.unlocked {
      background: #fef3c7;
      color: #92400e;
      border-color: #fbbf24;
    }
    
    .unlock-btn.unlocked:hover {
      background: #fde68a;
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }
      
      h1 {
        font-size: 1.5em;
      }
      
      .legend {
        flex-direction: column;
        gap: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô</h1>
    <p class="subtitle">26 - 31 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2025</p>
    
    <div style="text-align: center; margin-bottom: 20px;">
      <button id="copyAllBtn" class="copy-all-btn">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏µ‡πâ</button>
    </div>
    
    <div class="schedule-grid" id="scheduleGrid"></div>
    
    <div class="legend">
      <div class="legend-item">
        <div class="legend-color" style="background: #10b981;"></div>
        <span><strong>‡∏ß‡πà‡∏≤‡∏á</strong></span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #ef4444;"></div>
        <span><strong>‡πÄ‡∏ï‡πá‡∏°</strong></span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #3b82f6;"></div>
        <span><strong>‡∏à‡∏¥‡∏ì</strong></span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #8b5cf6;"></div>
        <span><strong>‡πÄ‡∏ó‡πá‡∏ô</strong></span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #f59e0b;"></div>
        <span><strong>‡∏á‡∏≤‡∏ô‡∏Ñ‡∏π‡πà</strong></span>
      </div>
    </div>
    
    <div class="note">
      üí° <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> Airbnb = ‡πÄ‡∏ß‡∏•‡∏≤ 20.00-09.00 | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 30-31 ‡∏ò.‡∏Ñ. ‡πÄ‡∏õ‡πá‡∏ô‡∏á‡∏≤‡∏ô‡∏Ñ‡∏π‡πà
    </div>

    <div style="text-align: center; margin-top: 30px;">
      <button id="unlockBtn" class="unlock-btn" onclick="toggleEditMode()">üîì ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
    </div>
  </div>

  <script>
    const scheduleData = {
      '2025-12-26': {
        day: '‡∏®‡∏∏‡∏Å‡∏£‡πå',
        date: '26 ‡∏ò.‡∏Ñ.',
        isCouple: false,
        jin: {
          'Airbnb (20:00-09:00)': false,
          '10:00-13:00': true,
          '14:00-17:00': true,
          '18:00-20:30': true
        },
        ten: {
          'Airbnb (20:00-09:00)': false,
          '10:00-13:00': true,
          '14:00-17:00': true,
          '18:00-20:30': true
        }
      },
      '2025-12-27': {
        day: '‡πÄ‡∏™‡∏≤‡∏£‡πå',
        date: '27 ‡∏ò.‡∏Ñ.',
        isCouple: false,
        jin: {
          'Airbnb (20:00-09:00)': false,
          '10:00-13:00': false,
          '14:00-17:00': true,
          '18:00-20:30': true
        },
        ten: {
          'Airbnb (20:00-09:00)': false,
          '10:00-13:00': false,
          '14:00-17:00': true,
          '18:00-20:30': true
        }
      },
      '2025-12-28': {
        day: '‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå',
        date: '28 ‡∏ò.‡∏Ñ.',
        isCouple: false,
        jin: {
          'Airbnb (20:00-09:00)': false,
          '10:00-13:00': true,
          '14:00-17:00': true,
          '18:00-20:30': true
        },
        ten: {
          'Airbnb (20:00-09:00)': false,
          '10:00-13:00': true,
          '14:00-17:00': true,
          '18:00-20:30': true
        }
      },
      '2025-12-29': {
        day: '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå',
        date: '29 ‡∏ò.‡∏Ñ.',
        isCouple: false,
        jin: {
          'Airbnb (20:00-09:00)': true,
          '10:00-13:00': true,
          '14:00-17:00': true,
          '18:00-20:30': true
        },
        ten: {
          'Airbnb (20:00-09:00)': true,
          '10:00-13:00': true,
          '14:00-17:00': true,
          '18:00-20:30': true
        }
      },
      '2025-12-30': {
        day: '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå',
        date: '30 ‡∏ò.‡∏Ñ.',
        isCouple: true,
        slots: {
          'Airbnb (20:00-09:00)': true,
          '10:00-13:00': true,
          '14:00-17:00': true,
          '18:00-20:30': true
        }
      },
      '2025-12-31': {
        day: '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£',
        date: '31 ‡∏ò.‡∏Ñ.',
        isCouple: true,
        slots: {
          'Airbnb (20:00-09:00)': true,
          '10:00-13:00': true,
          '14:00-17:00': true,
          '18:00-20:30': true
        }
      }
    };

    const slotMapping = [
      'Airbnb (20:00-09:00)',
      '10:00-13:00',
      '14:00-17:00',
      '18:00-20:30'
    ];

    function parseURLParameters() {
      const params = new URLSearchParams(window.location.search);
      
      // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ state parameter (‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà)
      if (params.has('state')) {
        const hex = params.get('state');
        
        // ‡πÅ‡∏õ‡∏•‡∏á hex ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô binary string
        let binary = '';
        for (let i = 0; i < hex.length; i++) {
          const bin = parseInt(hex[i], 16).toString(2).padStart(4, '0');
          binary += bin;
        }
        
        // ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏™‡πà‡πÉ‡∏ô scheduleData
        let index = 0;
        Object.keys(scheduleData).forEach(dateKey => {
          const dayData = scheduleData[dateKey];
          
          if (dayData.isCouple) {
            Object.keys(dayData.slots).forEach(timeSlot => {
              if (index < binary.length) {
                dayData.slots[timeSlot] = binary[index] === '1';
                index++;
              }
            });
          } else {
            ['jin', 'ten'].forEach(person => {
              Object.keys(dayData[person]).forEach(timeSlot => {
                if (index < binary.length) {
                  dayData[person][timeSlot] = binary[index] === '1';
                  index++;
                }
              });
            });
          }
        });
        
        return [];
      }
      
      // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏Å‡πà‡∏≤ (d, p, s, v)
      const updates = [];
      const dates = params.getAll('d');
      const persons = params.getAll('p');
      const slots = params.getAll('s');
      const values = params.getAll('v');
      
      for (let i = 0; i < dates.length; i++) {
        if (dates[i] && slots[i] !== undefined && values[i] !== undefined) {
          const year = '20' + dates[i].substring(0, 2);
          const month = dates[i].substring(2, 4);
          const day = dates[i].substring(4, 6);
          const fullDate = `${year}-${month}-${day}`;
          
          const personMap = { 'j': 'jin', 't': 'ten' };
          
          updates.push({
            date: fullDate,
            person: personMap[persons[i]] || null,
            slot: parseInt(slots[i]),
            status: parseInt(values[i]) === 1
          });
        }
      }
      
      return updates;
    }

    function generateShortLink(dateKey, person, slotIndex, currentStatus) {
      const baseUrl = window.location.origin + window.location.pathname;
      const dateShort = dateKey.substring(2).replace(/-/g, '');
      const personShort = person === 'jin' ? 'j' : (person === 'ten' ? 't' : '');
      const newStatus = currentStatus ? 0 : 1;
      
      let params = `d=${dateShort}`;
      if (personShort) params += `&p=${personShort}`;
      params += `&s=${slotIndex}&v=${newStatus}`;
      
      return `${baseUrl}?${params}`;
    }

    function generateFullScheduleLink() {
      const baseUrl = window.location.origin + window.location.pathname;
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠: ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô string ‡∏Ç‡∏≠‡∏á 0 ‡πÅ‡∏•‡∏∞ 1
      let encoded = '';
      
      Object.keys(scheduleData).forEach(dateKey => {
        const dayData = scheduleData[dateKey];
        
        if (dayData.isCouple) {
          // ‡∏á‡∏≤‡∏ô‡∏Ñ‡∏π‡πà: 4 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (4 slots)
          Object.keys(dayData.slots).forEach(timeSlot => {
            encoded += dayData.slots[timeSlot] ? '1' : '0';
          });
        } else {
          // ‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏ô: ‡∏à‡∏¥‡∏ì 4 ‡∏ï‡∏±‡∏ß + ‡πÄ‡∏ó‡πá‡∏ô 4 ‡∏ï‡∏±‡∏ß = 8 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
          ['jin', 'ten'].forEach(person => {
            Object.keys(dayData[person]).forEach(timeSlot => {
              encoded += dayData[person][timeSlot] ? '1' : '0';
            });
          });
        }
      });
      
      // ‡πÅ‡∏õ‡∏•‡∏á binary string ‡πÄ‡∏õ‡πá‡∏ô hex ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô‡∏•‡∏á
      let hex = '';
      for (let i = 0; i < encoded.length; i += 4) {
        const chunk = encoded.substr(i, 4);
        hex += parseInt(chunk, 2).toString(16);
      }
      
      return `${baseUrl}?state=${hex}`;
    }

    function copyFullSchedule() {
      const link = generateFullScheduleLink();
      const btn = document.getElementById('copyAllBtn');
      
      navigator.clipboard.writeText(link).then(() => {
        const originalText = btn.textContent;
        btn.textContent = '‚úì ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!';
        btn.classList.add('copied');
        
        setTimeout(() => {
          btn.textContent = originalText;
          btn.classList.remove('copied');
        }, 2000);
      }).catch(err => {
        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ: ' + err);
      });
    }

    let adminMode = false;
    let editMode = false;

    function toggleEditMode() {
      editMode = !editMode;
      const btn = document.getElementById('unlockBtn');
      
      if (editMode) {
        btn.textContent = 'üîí ‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
        btn.classList.add('unlocked');
      } else {
        btn.textContent = 'üîì ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
        btn.classList.remove('unlocked');
      }
      
      renderSchedule();
    }

    function toggleSlotStatus(dateKey, person, timeSlot) {
      if (!editMode) return;
      
      const dayData = scheduleData[dateKey];
      
      if (dayData.isCouple) {
        dayData.slots[timeSlot] = !dayData.slots[timeSlot];
      } else {
        dayData[person][timeSlot] = !dayData[person][timeSlot];
      }
      
      renderSchedule();
    }

    function toggleAdminMode() {
      adminMode = !adminMode;
      document.getElementById('adminSection').style.display = adminMode ? 'block' : 'none';
      renderSchedule();
    }

    function checkAdminMode() {
      const params = new URLSearchParams(window.location.search);
      if (params.has('admin')) {
        adminMode = true;
        document.getElementById('adminSection').style.display = 'block';
      }
    }

    function copyLink(link, button) {
      navigator.clipboard.writeText(link).then(() => {
        button.textContent = '‚úì';
        button.classList.add('copied');
        
        setTimeout(() => {
          button.textContent = 'üìã';
          button.classList.remove('copied');
        }, 2000);
      }).catch(err => {
        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ: ' + err);
      });
    }

    function applyUpdates(updates) {
      updates.forEach(update => {
        const { date, person, slot, status } = update;
        
        if (scheduleData[date]) {
          const slotName = slotMapping[slot];
          
          if (scheduleData[date].isCouple) {
            if (scheduleData[date].slots[slotName] !== undefined) {
              scheduleData[date].slots[slotName] = status;
            }
          } else {
            if (person === 'jin' && scheduleData[date].jin[slotName] !== undefined) {
              scheduleData[date].jin[slotName] = status;
            } else if (person === 'ten' && scheduleData[date].ten[slotName] !== undefined) {
              scheduleData[date].ten[slotName] = status;
            }
          }
        }
      });
    }

    function renderSchedule() {
      const grid = document.getElementById('scheduleGrid');
      grid.innerHTML = '';
      
      Object.keys(scheduleData).forEach(dateKey => {
        const dayData = scheduleData[dateKey];
        
        const dayCard = document.createElement('div');
        dayCard.className = 'day-card' + (dayData.isCouple ? ' couple-work' : '');
        
        const dayHeader = document.createElement('div');
        dayHeader.className = 'day-header' + (dayData.isCouple ? ' couple' : '');
        dayHeader.innerHTML = `
          <span class="day-name">${dayData.day}</span>
          <div style="display: flex; align-items: center; gap: 10px;">
            ${dayData.isCouple ? '<span class="couple-badge">‡∏á‡∏≤‡∏ô‡∏Ñ‡∏π‡πà</span>' : ''}
            <span class="day-date">${dayData.date}</span>
          </div>
        `;
        
        dayCard.appendChild(dayHeader);
        
        if (dayData.isCouple) {
          const timeSlots = document.createElement('div');
          timeSlots.className = 'time-slots';
          
          Object.keys(dayData.slots).forEach(timeSlot => {
            const slotDiv = document.createElement('div');
            slotDiv.className = 'time-slot' + (editMode ? ' editable' : '');
            
            const isAvailable = dayData.slots[timeSlot];
            const slotIndex = Object.keys(dayData.slots).indexOf(timeSlot);
            const link = generateShortLink(dateKey, null, slotIndex, isAvailable);
            
            if (editMode) {
              slotDiv.onclick = function() { toggleSlotStatus(dateKey, null, timeSlot); };
            }
            
            const timeLabel = document.createElement('span');
            timeLabel.className = 'time-label';
            timeLabel.textContent = timeSlot;
            
            const statusSpan = document.createElement('span');
            statusSpan.className = `status ${isAvailable ? 'available' : 'full'}`;
            statusSpan.textContent = isAvailable ? '‡∏ß‡πà‡∏≤‡∏á' : '‡πÄ‡∏ï‡πá‡∏°';
            
            if (adminMode) {
              const statusWrapper = document.createElement('div');
              statusWrapper.style.cssText = 'display: flex; align-items: center; gap: 8px;';
              
              const copyBtn = document.createElement('button');
              copyBtn.className = 'copy-btn';
              copyBtn.textContent = 'üìã';
              copyBtn.onclick = function(e) { 
                e.stopPropagation();
                copyLink(link, this); 
              };
              
              statusWrapper.appendChild(statusSpan);
              statusWrapper.appendChild(copyBtn);
              slotDiv.appendChild(timeLabel);
              slotDiv.appendChild(statusWrapper);
            } else {
              slotDiv.appendChild(timeLabel);
              slotDiv.appendChild(statusSpan);
            }
            
            timeSlots.appendChild(slotDiv);
          });
          
          dayCard.appendChild(timeSlots);
        } else {
          const dualGrid = document.createElement('div');
          dualGrid.className = 'dual-person-grid';
          
          ['jin', 'ten'].forEach(person => {
            const personSection = document.createElement('div');
            personSection.className = `person-section ${person}`;
            
            const personHeader = document.createElement('div');
            personHeader.className = `person-header ${person}`;
            personHeader.textContent = person === 'jin' ? 'üë§ ‡∏à‡∏¥‡∏ì' : 'üë§ ‡πÄ‡∏ó‡πá‡∏ô';
            personSection.appendChild(personHeader);
            
            const timeSlots = document.createElement('div');
            timeSlots.className = 'time-slots';
            
            Object.keys(dayData[person]).forEach(timeSlot => {
              const slotDiv = document.createElement('div');
              slotDiv.className = 'time-slot' + (editMode ? ' editable' : '');
              
              const isAvailable = dayData[person][timeSlot];
              const slotIndex = Object.keys(dayData[person]).indexOf(timeSlot);
              const link = generateShortLink(dateKey, person, slotIndex, isAvailable);
              
              if (editMode) {
                slotDiv.onclick = function() { toggleSlotStatus(dateKey, person, timeSlot); };
              }
              
              const timeLabel = document.createElement('span');
              timeLabel.className = 'time-label';
              timeLabel.textContent = timeSlot;
              
              const statusSpan = document.createElement('span');
              statusSpan.className = `status ${isAvailable ? 'available' : 'full'}`;
              statusSpan.textContent = isAvailable ? '‡∏ß‡πà‡∏≤‡∏á' : '‡πÄ‡∏ï‡πá‡∏°';
              
              if (adminMode) {
                const statusWrapper = document.createElement('div');
                statusWrapper.style.cssText = 'display: flex; align-items: center; gap: 8px;';
                
                const copyBtn = document.createElement('button');
                copyBtn.className = 'copy-btn';
                copyBtn.textContent = 'üìã';
                copyBtn.onclick = function(e) { 
                  e.stopPropagation();
                  copyLink(link, this); 
                };
                
                statusWrapper.appendChild(statusSpan);
                statusWrapper.appendChild(copyBtn);
                slotDiv.appendChild(timeLabel);
                slotDiv.appendChild(statusWrapper);
              } else {
                slotDiv.appendChild(timeLabel);
                slotDiv.appendChild(statusSpan);
              }
              
              timeSlots.appendChild(slotDiv);
            });
            
            personSection.appendChild(timeSlots);
            dualGrid.appendChild(personSection);
          });
          
          dayCard.appendChild(dualGrid);
        }
        
        grid.appendChild(dayCard);
      });
    }

    const updates = parseURLParameters();
    if (updates.length > 0) {
      applyUpdates(updates);
    }
    
    renderSchedule();
    
    document.getElementById('copyAllBtn').addEventListener('click', copyFullSchedule);
  </script>
</body>
</html>
